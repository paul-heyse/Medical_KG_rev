
<!doctype html>
<html lang="en" class="no-js">
  <head>

      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">






      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.21">



        <title>Orchestration Pipelines Guide - Medical KG Documentation</title>



      <link rel="stylesheet" href="../../assets/stylesheets/main.2a3383ac.min.css">












        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>



      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">

    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>






  </head>


    <body dir="ltr">


    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">


        <a href="#orchestration-pipelines-guide" class="md-skip">
          Skip to content
        </a>

    </div>
    <div data-md-component="announce">

    </div>




<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Medical KG Documentation" class="md-header__button md-logo" aria-label="Medical KG Documentation" data-md-component="logo">


  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">

      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Medical KG Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">

              Orchestration Pipelines Guide

          </span>
        </div>
      </div>
    </div>


      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>





        <label class="md-header__button md-icon" for="__search">

          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">

        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>

        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">

        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">

          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>

    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>



      <div class="md-header__source">
        <a href="https://github.com/example/medical_kg_rev" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">

    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>

  </nav>

</header>

    <div class="md-container" data-md-component="container">





<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">






    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">





  Home

      </a>
    </li>










      <li class="md-tabs__item">
        <a href="../../architecture/overview/" class="md-tabs__link">



  Architecture

        </a>
      </li>











      <li class="md-tabs__item">
        <a href="../../devops/ci-cd/" class="md-tabs__link">



  DevOps & Observability

        </a>
      </li>











      <li class="md-tabs__item">
        <a href="../retrieval/user-guide/" class="md-tabs__link">



  Retrieval

        </a>
      </li>











      <li class="md-tabs__item">
        <a href="../../openapi.yaml" class="md-tabs__link">



  API Contracts

        </a>
      </li>











      <li class="md-tabs__item">
        <a href="../../api/coordinators/" class="md-tabs__link">



  Pipeline API

        </a>
      </li>




    </ul>
  </div>
</nav>



      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">



              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">






<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Medical KG Documentation" class="md-nav__button md-logo" aria-label="Medical KG Documentation" data-md-component="logo">


  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Medical KG Documentation
  </label>

    <div class="md-nav__source">
      <a href="https://github.com/example/medical_kg_rev" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">

    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>

  <ul class="md-nav__list" data-md-scrollfix>







    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">



  <span class="md-ellipsis">
    Home

  </span>


      </a>
    </li>

















    <li class="md-nav__item md-nav__item--nested">



        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >


          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">



  <span class="md-ellipsis">
    Architecture

  </span>


            <span class="md-nav__icon md-icon"></span>
          </label>

        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Architecture
          </label>
          <ul class="md-nav__list" data-md-scrollfix>







    <li class="md-nav__item">
      <a href="../../architecture/overview/" class="md-nav__link">



  <span class="md-ellipsis">
    Overview

  </span>


      </a>
    </li>




          </ul>
        </nav>

    </li>

















    <li class="md-nav__item md-nav__item--nested">



        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >


          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">



  <span class="md-ellipsis">
    DevOps & Observability

  </span>


            <span class="md-nav__icon md-icon"></span>
          </label>

        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            DevOps & Observability
          </label>
          <ul class="md-nav__list" data-md-scrollfix>







    <li class="md-nav__item">
      <a href="../../devops/ci-cd/" class="md-nav__link">



  <span class="md-ellipsis">
    CI/CD Pipeline

  </span>


      </a>
    </li>










    <li class="md-nav__item">
      <a href="../../devops/local-environments/" class="md-nav__link">



  <span class="md-ellipsis">
    Local Environments

  </span>


      </a>
    </li>










    <li class="md-nav__item">
      <a href="../../devops/observability/" class="md-nav__link">



  <span class="md-ellipsis">
    Observability

  </span>


      </a>
    </li>










    <li class="md-nav__item">
      <a href="../../devops/kubernetes/" class="md-nav__link">



  <span class="md-ellipsis">
    Kubernetes

  </span>


      </a>
    </li>










    <li class="md-nav__item">
      <a href="../../operations/retrieval-rollout/" class="md-nav__link">



  <span class="md-ellipsis">
    Retrieval Rollout Runbook

  </span>


      </a>
    </li>




          </ul>
        </nav>

    </li>

















    <li class="md-nav__item md-nav__item--nested">



        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >


          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">



  <span class="md-ellipsis">
    Retrieval

  </span>


            <span class="md-nav__icon md-icon"></span>
          </label>

        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Retrieval
          </label>
          <ul class="md-nav__list" data-md-scrollfix>







    <li class="md-nav__item">
      <a href="../retrieval/user-guide/" class="md-nav__link">



  <span class="md-ellipsis">
    User Guide

  </span>


      </a>
    </li>










    <li class="md-nav__item">
      <a href="../retrieval/developer-guide/" class="md-nav__link">



  <span class="md-ellipsis">
    Developer Guide

  </span>


      </a>
    </li>




          </ul>
        </nav>

    </li>

















    <li class="md-nav__item md-nav__item--nested">



        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >


          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">



  <span class="md-ellipsis">
    API Contracts

  </span>


            <span class="md-nav__icon md-icon"></span>
          </label>

        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            API Contracts
          </label>
          <ul class="md-nav__list" data-md-scrollfix>







    <li class="md-nav__item">
      <a href="../../openapi.yaml" class="md-nav__link">



  <span class="md-ellipsis">
    REST OpenAPI

  </span>


      </a>
    </li>










    <li class="md-nav__item">
      <a href="../../schema.graphql" class="md-nav__link">



  <span class="md-ellipsis">
    GraphQL SDL

  </span>


      </a>
    </li>










    <li class="md-nav__item">
      <a href="../../asyncapi.yaml" class="md-nav__link">



  <span class="md-ellipsis">
    AsyncAPI

  </span>


      </a>
    </li>




          </ul>
        </nav>

    </li>

















    <li class="md-nav__item md-nav__item--nested">



        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >


          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">



  <span class="md-ellipsis">
    Pipeline API

  </span>


            <span class="md-nav__icon md-icon"></span>
          </label>

        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Pipeline API
          </label>
          <ul class="md-nav__list" data-md-scrollfix>







    <li class="md-nav__item">
      <a href="../../api/coordinators/" class="md-nav__link">



  <span class="md-ellipsis">
    Coordinators

  </span>


      </a>
    </li>










    <li class="md-nav__item">
      <a href="../../api/services/" class="md-nav__link">



  <span class="md-ellipsis">
    Services

  </span>


      </a>
    </li>










    <li class="md-nav__item">
      <a href="../../api/embedding/" class="md-nav__link">



  <span class="md-ellipsis">
    Embedding

  </span>


      </a>
    </li>










    <li class="md-nav__item">
      <a href="../../api/orchestration/" class="md-nav__link">



  <span class="md-ellipsis">
    Orchestration

  </span>


      </a>
    </li>




          </ul>
        </nav>

    </li>



  </ul>
</nav>
                  </div>
                </div>
              </div>



              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">


<nav class="md-nav md-nav--secondary" aria-label="Table of contents">






    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>

        <li class="md-nav__item">
  <a href="#dagster-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      Dagster Architecture
    </span>
  </a>

    <nav class="md-nav" aria-label="Dagster Architecture">
      <ul class="md-nav__list">

          <li class="md-nav__item">
  <a href="#stage-plugin-system" class="md-nav__link">
    <span class="md-ellipsis">
      Stage Plugin System
    </span>
  </a>

</li>

      </ul>
    </nav>

</li>

        <li class="md-nav__item">
  <a href="#pipeline-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Pipeline Configuration
    </span>
  </a>

</li>

        <li class="md-nav__item">
  <a href="#execution-flow" class="md-nav__link">
    <span class="md-ellipsis">
      Execution Flow
    </span>
  </a>

</li>

        <li class="md-nav__item">
  <a href="#typed-pipeline-state-lifecycle-hooks" class="md-nav__link">
    <span class="md-ellipsis">
      Typed Pipeline State &amp; Lifecycle Hooks
    </span>
  </a>

</li>

        <li class="md-nav__item">
  <a href="#troubleshooting" class="md-nav__link">
    <span class="md-ellipsis">
      Troubleshooting
    </span>
  </a>

</li>

        <li class="md-nav__item">
  <a href="#operational-notes" class="md-nav__link">
    <span class="md-ellipsis">
      Operational Notes
    </span>
  </a>

</li>

    </ul>

</nav>
                  </div>
                </div>
              </div>



            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">








<h1 id="orchestration-pipelines-guide">Orchestration Pipelines Guide</h1>
<p>This guide describes the Dagster-based orchestration stack that replaced the
legacy worker pipeline. The gateway and CLI interact with Dagster definitions
under <code>Medical_KG_rev.orchestration.dagster</code> and Haystack components under
<code>Medical_KG_rev.orchestration.haystack</code>.</p>
<h2 id="dagster-architecture">Dagster Architecture</h2>
<ul>
<li><strong>Stage contracts</strong> – <code>StageContext</code>, <code>ChunkStage</code>, <code>EmbedStage</code>, and other
  protocols live in <code>Medical_KG_rev.orchestration.stages.contracts</code>. Dagster ops
  call these protocols so stage implementations remain framework-agnostic.</li>
<li><strong>Typed pipeline state</strong> – <code>PipelineState</code> is exposed to Dagster as a
  first-class type. It enforces stage output validation, records lifecycle
  metrics, and surfaces profiling data for observability dashboards.</li>
<li><strong>StageFactory</strong> – <code>StageFactory</code> resolves stage definitions from topology
  YAML files. The default factory wires Haystack chunking, embedding, and
  indexing components while falling back to lightweight stubs for unit tests.</li>
<li><strong>Runtime module</strong> – <code>Medical_KG_rev.orchestration.dagster.runtime</code> defines
  jobs, resources, and helper utilities (<code>DagsterOrchestrator</code>,
  <code>submit_to_dagster</code>). Jobs call the appropriate stage implementation and
  update the job ledger after each op.</li>
<li><strong>Haystack wrappers</strong> – <code>Medical_KG_rev.orchestration.haystack.components</code>
  adapts Haystack classes to the stage protocols. The chunker converts IR
  documents into Haystack documents, the embedder produces dense vectors (with
  optional sparse expansion), and the index writer dual writes to OpenSearch and
  FAISS.</li>
</ul>
<h3 id="stage-plugin-system">Stage Plugin System</h3>
<ul>
<li><strong>StagePlugin base class</strong> – <code>StagePlugin</code> in
  <code>Medical_KG_rev.orchestration.stages.plugins</code> exposes typed metadata,
  dependency declarations, lifecycle hooks (<code>initialize</code>, <code>cleanup</code>,
  <code>health_check</code>), and helpers (<code>create_registration</code>) so plugins can register
  stage builders with a few lines of code.</li>
<li><strong>Lifecycle management</strong> – <code>StagePluginManager</code> keeps a registry of
  <code>StagePluginRegistration</code> instances per stage type, orders them using declared
  dependencies, and exposes <code>unregister()</code>, <code>describe_plugins()</code>, and
  <code>check_health()</code> for operational tooling.</li>
<li><strong>Dependency-aware resolution</strong> – Registrations can depend on other plugins by
  referencing the fully qualified metadata name (e.g., <code>core-stage.chunk</code>). The
  manager topologically sorts registrations before attempting builds, so
  fallbacks are only invoked after primary providers fail.</li>
<li><strong>Health diagnostics</strong> – Health signals returned from <code>StagePlugin.health_check</code>
  are cached on each registration state and surfaced through
  <code>describe_plugins()</code>, simplifying automation hooks for dashboards and alerts.</li>
</ul>
<h2 id="pipeline-configuration">Pipeline Configuration</h2>
<ul>
<li><strong>Topology YAML</strong> – Pipelines are described in
  <code>config/orchestration/pipelines/*.yaml</code>. Each stage lists <code>name</code>, <code>type</code>,
  optional <code>policy</code>, dependencies, and a free-form <code>config</code> block. Gates define
  resume conditions, e.g., <code>pdf_ir_ready=true</code> for two-phase PDF ingestion.</li>
<li><strong>Resilience policies</strong> – <code>config/orchestration/resilience.yaml</code> contains
  shared retry, circuit breaker, and rate limiting definitions. The runtime
  loads these into Tenacity, PyBreaker, and aiolimiter objects.</li>
<li><strong>Version manifest</strong> – <code>config/orchestration/versions/*</code> tracks pipeline
  revisions. <code>PipelineConfigLoader</code> loads and caches versions to provide
  deterministic orchestration.</li>
</ul>
<p>Typed dependencies are derived from the stage contracts. For example, an
<code>embed</code> stage automatically depends on the most recent <code>chunk</code> stage and the
<code>index</code> stage requires <code>embed</code>. Pipelines that omit these prerequisites fail
validation during configuration loading instead of during runtime execution.</p>
<h2 id="execution-flow">Execution Flow</h2>
<ol>
<li><strong>Job submission</strong> – The gateway builds a <code>StageContext</code> and calls
   <code>submit_to_dagster</code>. The Dagster run stores the initial state using the job
   ledger resource.</li>
<li><strong>Stage execution</strong> – Each op resolves the stage implementation via
   <code>StageFactory</code>. Resilience policies wrap the execution and emit metrics on
   retries, circuit breaker state changes, and rate limiting delays.</li>
<li><strong>Ledger updates</strong> – Ops record progress to the job ledger (<code>current_stage</code>,
   attempt counts, gate metadata). Sensors poll the ledger for gate conditions
   (e.g., <code>pdf_ir_ready=true</code>) and resume downstream stages.</li>
<li><strong>Outputs</strong> – Stage results are added to the Dagster run state and surfaced
   to the gateway through the ledger/SSE stream. Haystack components persist
   embeddings and metadata in downstream storage systems.</li>
</ol>
<h2 id="typed-pipeline-state-lifecycle-hooks">Typed Pipeline State &amp; Lifecycle Hooks</h2>
<ul>
<li><strong>Dagster type integration</strong> – The orchestration runtime publishes the
  <code>PipelineState</code> Dagster type so ops receive runtime validation and better UI
  introspection inside Dagster.</li>
<li><strong>Lifecycle hooks</strong> – Call <code>state.register_lifecycle_hook(...)</code> to observe
  stage start, completion, and failure events. Hooks power metrics, tracing, or
  custom auditing without modifying the runtime.</li>
<li><strong>Profiling</strong> – Every state instance tracks lightweight profiling samples via
  <code>state.profiling_summary()</code> and <code>state.profiling_samples()</code>. These aggregates
  capture duration, attempt counts, and output totals per stage.</li>
</ul>
<h2 id="troubleshooting">Troubleshooting</h2>
<ul>
<li><strong>Stage resolution errors</strong> – Verify the stage <code>type</code> in the topology YAML
  matches the plugins registered via <code>build_stage_factory</code>. Unknown stage
  matches the stage types advertised by <code>create_stage_plugin_manager</code>. Unknown stage
  types raise <code>StageResolutionError</code> during job execution.</li>
<li><strong>Resilience misconfiguration</strong> – Check <code>config/orchestration/resilience.yaml</code>
  for required fields (attempts, backoff, circuit breaker thresholds). Invalid
  policies raise validation errors at load time.</li>
<li><strong>Gate stalls</strong> – Inspect the job ledger entry to confirm gate metadata is
  set (e.g., <code>pdf_ir_ready</code> for PDF pipelines). Sensors poll every ten seconds
  and record trigger counts in the ledger metadata.</li>
<li><strong>Missing embeddings</strong> – Ensure the embed stage resolved the Haystack
  embedder; stubs return deterministic values for test runs but do not persist
  to OpenSearch/FAISS.</li>
</ul>
<h2 id="operational-notes">Operational Notes</h2>
<ul>
<li>Run Dagster locally with
  <code>dagster dev -m Medical_KG_rev.orchestration.dagster.runtime</code> to access the UI
  and sensors.</li>
<li>The gateway uses <code>StageFactory</code> directly for synchronous operations (chunking
  and embedding APIs) to avoid spinning up full Dagster runs.</li>
<li>Dagster daemon processes handle sensors and schedules. Ensure the daemon has
  access to the same configuration volume as the webserver and gateway.</li>
<li>CloudEvents and OpenLineage emission hooks live alongside the Dagster jobs
  and reuse the resilience policy loader for consistent telemetry metadata.</li>
</ul>













              </article>
            </div>


<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>

      </main>

        <footer class="md-footer">

  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">


    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>

</div>

    </div>
  </div>
</footer>

    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>




      <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.instant", "navigation.tabs", "content.code.copy"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>


      <script src="../../assets/javascripts/bundle.f55a23d4.min.js"></script>


  </body>
</html>
